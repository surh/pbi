
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="http://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="http://yihui.name/knitr"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.16</code>)
    .</p>

<div class="chunk" id="auto-report"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># (C) Copyright 2016 Sur Herrera Paredes</span>
<span class="hl com">#</span>
<span class="hl com">#    This file is part of pbi.</span>
<span class="hl com">#</span>
<span class="hl com">#    pbi is free software: you can redistribute it and/or modify</span>
<span class="hl com">#    it under the terms of the GNU General Public License as published by</span>
<span class="hl com">#    the Free Software Foundation, either version 3 of the License, or</span>
<span class="hl com">#    (at your option) any later version.</span>
<span class="hl com">#</span>
<span class="hl com">#    pbi is distributed in the hope that it will be useful,</span>
<span class="hl com">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="hl com">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="hl com">#    GNU General Public License for more details.</span>
<span class="hl com">#</span>
<span class="hl com">#    You should have received a copy of the GNU General Public License</span>
<span class="hl com">#    along with pbi.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="hl com"># This is a self contained demonstration of how to use the monte_carlo functions.</span>
<span class="hl com"># It uses a dataset contained in the AMOR package (https://github.com/surh/AMOR).</span>
<span class="hl com"># It is redundant in the sense that some functions have been copied from other parts</span>
<span class="hl com"># of the repository into here</span>

<span class="hl com">############ LOAD FUNCTIONS AND AMOR PACKAGE #############</span>
<span class="hl kwd">library</span><span class="hl std">(AMOR)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: ggplot2
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: ggdendro
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: reshape2
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: grid
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: MASS
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#' Plot fracgen heatmap</span>
<span class="hl com">#' </span>
<span class="hl com">#' First selects the variables that match the egular expression and then</span>
<span class="hl com">#' finds the significant ones using sig_thres. Requires columns with the</span>
<span class="hl com">#' appropriate names in Full, meaning Taxon, Variable and q.value</span>
<span class="hl com">#' </span>
<span class="hl com">#' The it processes the dataset object. Rescales the abundance to percent,</span>
<span class="hl com">#' requires a Depth variable in the Map, and removes any taxa that are never</span>
<span class="hl com">#' significant. Removes Soil and R fraction samples (requires a Fraction</span>
<span class="hl com">#' variable with R and Soil values in it), and pools samples by genotype</span>
<span class="hl com">#' (requires a Genotype variable in the Map)</span>
<span class="hl com">#' </span>
<span class="hl com">#' </span>
<span class="hl com">#' @param Full output from combine_models</span>
<span class="hl com">#' @param Dat Dataset object</span>
<span class="hl com">#' @param group character vector indicating experiments to keep.</span>
<span class="hl com">#' @param variable regular expression used to extract variable of interest</span>
<span class="hl com">#' @param sig_thres significance threshold</span>
<span class="hl com">#' @param pool.FUN function to use when pooling observations for the heatmap</span>
<span class="hl com">#' @param phyl.level level at which phylum is found in Tax</span>
<span class="hl com">#' @param mut_order</span>
<span class="hl std">plot_fragen_heatmap</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">Full</span><span class="hl std">,</span><span class="hl kwc">Dat</span><span class="hl std">,</span><span class="hl kwc">group</span><span class="hl std">,</span> <span class="hl kwc">variable</span> <span class="hl std">=</span> <span class="hl str">&quot;FracgenEC:&quot;</span><span class="hl std">,</span>
                                <span class="hl kwc">sig_thres</span> <span class="hl std">=</span> <span class="hl num">0.05</span><span class="hl std">,</span> <span class="hl kwc">pool.FUN</span> <span class="hl std">= mean,</span> <span class="hl kwc">phyl.level</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span>
                                <span class="hl kwc">mut_order</span><span class="hl std">){</span>

  <span class="hl com"># Get significant</span>
  <span class="hl std">Gen</span> <span class="hl kwb">&lt;-</span> <span class="hl std">Full[</span> <span class="hl kwd">grep</span><span class="hl std">(variable,Full</span><span class="hl opt">$</span><span class="hl std">Variable), ]</span>
  <span class="hl std">fracgen_effect</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.character</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Gen</span><span class="hl opt">$</span><span class="hl std">Taxon[ Gen</span><span class="hl opt">$</span><span class="hl std">q.value</span> <span class="hl opt">&lt;</span> <span class="hl std">sig_thres ]))</span>
  <span class="hl std">Gen</span> <span class="hl kwb">&lt;-</span> <span class="hl std">Gen[ Gen</span><span class="hl opt">$</span><span class="hl std">Taxon</span> <span class="hl opt">%in%</span> <span class="hl std">fracgen_effect, ]</span>
  <span class="hl std">Gen</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">droplevels</span><span class="hl std">(Gen)</span>
  <span class="hl std">Gen</span><span class="hl opt">$</span><span class="hl std">Taxon</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(Gen</span><span class="hl opt">$</span><span class="hl std">Taxon)</span>
  <span class="hl std">Gen</span><span class="hl opt">$</span><span class="hl std">significant</span> <span class="hl kwb">&lt;-</span> <span class="hl std">Gen</span><span class="hl opt">$</span><span class="hl std">q.value</span> <span class="hl opt">&lt;</span> <span class="hl std">sig_thres</span>


  <span class="hl com"># Process Dat</span>
  <span class="hl std">pool.FUN</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">match.fun</span><span class="hl std">(pool.FUN)</span>
  <span class="hl com"># Get samples in group and rescale</span>
  <span class="hl std">to_remove</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">row.names</span><span class="hl std">(Dat</span><span class="hl opt">$</span><span class="hl std">Map)[</span> <span class="hl opt">!</span><span class="hl std">(Dat</span><span class="hl opt">$</span><span class="hl std">Map</span><span class="hl opt">$</span><span class="hl std">Experiment</span> <span class="hl opt">%in%</span> <span class="hl std">group) ]</span>
  <span class="hl std">Dat.group</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">remove_samples</span><span class="hl std">(Dat,</span> <span class="hl kwc">samples</span> <span class="hl std">= to_remove)</span>
  <span class="hl com">#   Dat.group &lt;- create_dataset(Tab = t(100 * t(Dat.group$Tab) / Dat.group$Map$Depth),</span>
  <span class="hl com">#                               Map = Dat.group$Map,</span>
  <span class="hl com">#                               Tax = data.frame(ID = row.names(Dat.group$Tab), </span>
  <span class="hl com">#                                                Taxonomy = row.names(Dat.group$Tab),</span>
  <span class="hl com">#                                                row.names = row.names(Dat.group$Tab)))</span>

  <span class="hl std">Dat.group</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">create_dataset</span><span class="hl std">(</span><span class="hl kwc">Tab</span> <span class="hl std">=</span> <span class="hl kwd">t</span><span class="hl std">(</span><span class="hl num">100</span> <span class="hl opt">*</span> <span class="hl kwd">t</span><span class="hl std">(Dat.group</span><span class="hl opt">$</span><span class="hl std">Tab)</span> <span class="hl opt">/</span> <span class="hl std">Dat.group</span><span class="hl opt">$</span><span class="hl std">Map</span><span class="hl opt">$</span><span class="hl std">Depth),</span>
                              <span class="hl kwc">Map</span> <span class="hl std">= Dat.group</span><span class="hl opt">$</span><span class="hl std">Map,</span>
                              <span class="hl kwc">Tax</span> <span class="hl std">= Dat.group</span><span class="hl opt">$</span><span class="hl std">Tax)</span>


  <span class="hl std">Dat.group</span><span class="hl opt">$</span><span class="hl std">Map</span><span class="hl opt">$</span><span class="hl std">Genotype</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(Dat.group</span><span class="hl opt">$</span><span class="hl std">Map</span><span class="hl opt">$</span><span class="hl std">Genotype,</span> <span class="hl kwc">levels</span> <span class="hl std">= mut_order)</span>
  <span class="hl com"># Remove non significant taxa</span>
  <span class="hl std">Dat.group</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">remove_taxons</span><span class="hl std">(</span><span class="hl kwc">Dat</span> <span class="hl std">= Dat.group,</span>
                             <span class="hl kwc">taxons</span> <span class="hl std">=</span> <span class="hl kwd">row.names</span><span class="hl std">(Dat.group</span><span class="hl opt">$</span><span class="hl std">Tab)[</span> <span class="hl opt">!</span><span class="hl std">(</span><span class="hl kwd">row.names</span><span class="hl std">(Dat.group</span><span class="hl opt">$</span><span class="hl std">Tab)</span> <span class="hl opt">%in%</span> <span class="hl kwd">levels</span><span class="hl std">(Gen</span><span class="hl opt">$</span><span class="hl std">Taxon)) ])</span>
  <span class="hl com"># Remove Soil and R samples</span>
  <span class="hl std">Dat.group</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">remove_samples</span><span class="hl std">(</span><span class="hl kwc">Dat</span> <span class="hl std">= Dat.group,</span>
                              <span class="hl kwc">samples</span> <span class="hl std">=</span> <span class="hl kwd">colnames</span><span class="hl std">(Dat.group</span><span class="hl opt">$</span><span class="hl std">Tab)[ Dat.group</span><span class="hl opt">$</span><span class="hl std">Map</span><span class="hl opt">$</span><span class="hl std">Fraction</span> <span class="hl opt">%in%</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;R&quot;</span><span class="hl std">,</span><span class="hl str">&quot;Soil&quot;</span><span class="hl std">) ])</span>
  <span class="hl com"># Pool by genotype</span>
  <span class="hl std">Dat.group</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">pool_samples</span><span class="hl std">(</span><span class="hl kwc">Dat</span> <span class="hl std">= Dat.group,</span> <span class="hl kwc">groups</span> <span class="hl std">=</span> <span class="hl str">&quot;Genotype&quot;</span><span class="hl std">,</span> <span class="hl kwc">FUN</span> <span class="hl std">= mean)</span>

  <span class="hl com"># Create plotting object</span>
  <span class="hl std">dat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(Dat.group</span><span class="hl opt">$</span><span class="hl std">Tab)</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">OTU</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">row.names</span><span class="hl std">(dat)</span>
  <span class="hl std">dat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">melt</span><span class="hl std">(dat,</span><span class="hl kwc">id.vars</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;OTU&quot;</span><span class="hl std">),</span><span class="hl kwc">value.name</span><span class="hl std">=</span><span class="hl str">&quot;Abundance&quot;</span><span class="hl std">,</span><span class="hl kwc">variable.name</span><span class="hl std">=</span><span class="hl str">&quot;Genotype&quot;</span><span class="hl std">)</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Abundance</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">log2</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">Abundance</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Enrichment</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Enrichment[</span> <span class="hl kwd">paste</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">OTU,variable,dat</span><span class="hl opt">$</span><span class="hl std">Genotype,</span><span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span> <span class="hl opt">%in%</span>
                    <span class="hl kwd">paste</span><span class="hl std">(Gen</span><span class="hl opt">$</span><span class="hl std">Taxon,Gen</span><span class="hl opt">$</span><span class="hl std">Variable,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">)[ Gen</span><span class="hl opt">$</span><span class="hl std">significant</span> <span class="hl opt">&amp;</span> <span class="hl std">Gen</span><span class="hl opt">$</span><span class="hl std">Estimate</span> <span class="hl opt">&gt;</span> <span class="hl num">0</span> <span class="hl std">] ]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Enrichment[</span> <span class="hl kwd">paste</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">OTU,variable,dat</span><span class="hl opt">$</span><span class="hl std">Genotype,</span><span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span> <span class="hl opt">%in%</span>
                    <span class="hl kwd">paste</span><span class="hl std">(Gen</span><span class="hl opt">$</span><span class="hl std">Taxon,Gen</span><span class="hl opt">$</span><span class="hl std">Variable,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">)[ Gen</span><span class="hl opt">$</span><span class="hl std">significant</span> <span class="hl opt">&amp;</span> <span class="hl std">Gen</span><span class="hl opt">$</span><span class="hl std">Estimate</span> <span class="hl opt">&lt;</span> <span class="hl num">0</span> <span class="hl std">] ]</span> <span class="hl kwb">&lt;-</span> <span class="hl opt">-</span><span class="hl num">1</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Phylum</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">get_tax_level</span><span class="hl std">(Dat.group</span><span class="hl opt">$</span><span class="hl std">Tax[</span><span class="hl kwd">as.character</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">OTU),],</span><span class="hl kwc">level</span> <span class="hl std">= phyl.level)</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Type</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;Mutant&quot;</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Type[ dat</span><span class="hl opt">$</span><span class="hl std">Genotype</span> <span class="hl opt">==</span> <span class="hl str">&quot;Col-0&quot;</span> <span class="hl std">]</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;WT&quot;</span>
  <span class="hl std">dat</span> <span class="hl kwb">&lt;-</span> <span class="hl std">dat[</span><span class="hl kwd">order</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">Phylum,dat</span><span class="hl opt">$</span><span class="hl std">Enrichment),]</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">OTU</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">OTU,</span><span class="hl kwc">levels</span> <span class="hl std">=</span> <span class="hl kwd">unique</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">OTU))</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Type</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">Type,</span><span class="hl kwc">levels</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;WT&quot;</span><span class="hl std">,</span><span class="hl str">&quot;Mutant&quot;</span><span class="hl std">))</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Enrichment</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">Enrichment,</span><span class="hl kwc">levels</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;-1&quot;</span><span class="hl std">,</span><span class="hl str">&quot;1&quot;</span><span class="hl std">,</span><span class="hl str">&quot;0&quot;</span><span class="hl std">))</span>
  <span class="hl std">dat</span> <span class="hl kwb">&lt;-</span> <span class="hl std">dat[</span><span class="hl kwd">order</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">Enrichment),]</span>

  <span class="hl std">p1</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ggplot</span><span class="hl std">(dat,</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=Genotype,</span><span class="hl kwc">y</span><span class="hl std">=OTU))</span> <span class="hl opt">+</span>
    <span class="hl com">#   geom_tile(aes(fill=Abundance,col=Enrichment),size=2) +</span>
    <span class="hl kwd">geom_tile</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=Abundance))</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_tile</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">col</span><span class="hl std">=Enrichment),</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl kwc">alpha</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl num">NA</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">facet_grid</span><span class="hl std">(Phylum</span> <span class="hl opt">~</span> <span class="hl std">Type,</span><span class="hl kwc">scales</span><span class="hl std">=</span><span class="hl str">&quot;free&quot;</span><span class="hl std">,</span><span class="hl kwc">space</span><span class="hl std">=</span><span class="hl str">&quot;free&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_continuous</span><span class="hl std">(</span><span class="hl kwc">low</span><span class="hl std">=</span><span class="hl str">&quot;white&quot;</span><span class="hl std">,</span><span class="hl kwc">high</span><span class="hl std">=</span><span class="hl str">&quot;black&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_colour_manual</span><span class="hl std">(</span><span class="hl kwc">values</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span><span class="hl str">&quot;red&quot;</span><span class="hl std">,</span><span class="hl num">NA</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">axis.text.y</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
          <span class="hl kwc">axis.ticks.y</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
          <span class="hl kwc">axis.text.x</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">face</span><span class="hl std">=</span><span class="hl str">&quot;bold&quot;</span><span class="hl std">,</span><span class="hl kwc">colour</span><span class="hl std">=</span><span class="hl str">&quot;black&quot;</span><span class="hl std">,</span>
                                     <span class="hl kwc">angle</span> <span class="hl std">=</span> <span class="hl num">90</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">20</span><span class="hl std">),</span>
          <span class="hl kwc">panel.background</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
          <span class="hl kwc">strip.text.y</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">angle</span> <span class="hl std">=</span> <span class="hl num">360</span><span class="hl std">))</span>

  <span class="hl kwd">return</span><span class="hl std">(p1)</span>
<span class="hl std">}</span>


<span class="hl com">#' Doughnut plot</span>
<span class="hl com">#' </span>
<span class="hl com">#' @param dat The output data attribute from plot_fracgen_heatmap</span>
<span class="hl com">#' @param top_phyla Phyla to show explicitly. The rest will be lumped into other</span>
<span class="hl com">#' @param mut_order Order of genotypes to show</span>
<span class="hl com">#' @param text_size Size of text for numbers inside doughnuts</span>
<span class="hl com">#' @param phyla_colors Vector of colors to use</span>
<span class="hl std">doughnut_plot</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">dat</span><span class="hl std">,</span><span class="hl kwc">top_phyla</span><span class="hl std">,</span> <span class="hl kwc">mut_order</span><span class="hl std">,</span> <span class="hl kwc">text_size</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">phyla_colors</span> <span class="hl std">= phyla_colors){</span>
  <span class="hl com"># mut_order &lt;- c('Col','Ler','mygen','Soil')</span>
  <span class="hl com"># top_phyla &lt;- c(&quot;Root;Root;k__Bacteria;p__Actinobacteria&quot;,</span>
  <span class="hl com">#               &quot;Root;Root;k__Bacteria;p__Bacteroidetes&quot;,</span>
  <span class="hl com">#               &quot;Root;Root;k__Bacteria;p__Proteobacteria&quot;)</span>

  <span class="hl std">count</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">ftable</span><span class="hl std">(Enrichment</span><span class="hl opt">~</span><span class="hl std">Genotype,dat)[</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl opt">-</span><span class="hl num">3</span><span class="hl std">],</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">row.names</span><span class="hl std">(count)</span> <span class="hl kwb">&lt;-</span> <span class="hl std">mut_order[</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl opt">-</span><span class="hl kwd">length</span><span class="hl std">(mut_order))]</span>
  <span class="hl kwd">colnames</span><span class="hl std">(count)</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Depletion&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Enrichment&quot;</span><span class="hl std">)</span>
  <span class="hl std">count</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">melt</span><span class="hl std">(count,</span><span class="hl kwc">varnames</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Genotype&quot;</span><span class="hl std">,</span><span class="hl str">&quot;Type&quot;</span><span class="hl std">),</span><span class="hl kwc">value.name</span> <span class="hl std">=</span> <span class="hl str">&quot;Total&quot;</span><span class="hl std">)</span>
  <span class="hl std">count</span><span class="hl opt">$</span><span class="hl std">Phylum</span> <span class="hl kwb">&lt;-</span> <span class="hl num">NA</span>
  <span class="hl std">count</span><span class="hl opt">$</span><span class="hl std">ymin</span> <span class="hl kwb">&lt;-</span> <span class="hl num">NA</span>
  <span class="hl std">count</span><span class="hl opt">$</span><span class="hl std">ymax</span> <span class="hl kwb">&lt;-</span> <span class="hl num">NA</span>

  <span class="hl std">enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl std">dat[ dat</span><span class="hl opt">$</span><span class="hl std">Enrichment</span> <span class="hl opt">==</span> <span class="hl num">1</span><span class="hl std">, ]</span>
  <span class="hl std">enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">calculate_enrich</span><span class="hl std">(</span><span class="hl kwc">enrich</span> <span class="hl std">= enrich,</span><span class="hl kwc">top_phyla</span> <span class="hl std">= top_phyla,</span>
                             <span class="hl kwc">mut_order</span> <span class="hl std">= mut_order)</span>
  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">Type</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;Enrichment&quot;</span>
  <span class="hl std">deplete</span> <span class="hl kwb">&lt;-</span> <span class="hl std">dat[ dat</span><span class="hl opt">$</span><span class="hl std">Enrichment</span> <span class="hl opt">== -</span><span class="hl num">1</span><span class="hl std">, ]</span>
  <span class="hl std">deplete</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">calculate_enrich</span><span class="hl std">(</span><span class="hl kwc">enrich</span> <span class="hl std">= deplete,</span><span class="hl kwc">top_phyla</span> <span class="hl std">= top_phyla,</span>
                              <span class="hl kwc">mut_order</span> <span class="hl std">= mut_order)</span>
  <span class="hl std">deplete</span><span class="hl opt">$</span><span class="hl std">Type</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;Depletion&quot;</span>
  <span class="hl std">enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">rbind</span><span class="hl std">(enrich,deplete)</span>
  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">Type</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(enrich</span><span class="hl opt">$</span><span class="hl std">Type,</span> <span class="hl kwc">levels</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Enrichment&quot;</span><span class="hl std">,</span><span class="hl str">&quot;Depletion&quot;</span><span class="hl std">))</span>

  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">Total</span> <span class="hl kwb">&lt;-</span> <span class="hl num">NA</span>
  <span class="hl std">enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">rbind</span><span class="hl std">(enrich,count)</span>

  <span class="hl std">p1</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ggplot</span><span class="hl std">(enrich,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">xmax</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">,</span> <span class="hl kwc">xmin</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">facet_grid</span><span class="hl std">(Type</span> <span class="hl opt">~</span> <span class="hl std">Genotype)</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_rect</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">=</span> <span class="hl kwd">subset</span><span class="hl std">(enrich,</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(ymin)),</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">ymax</span> <span class="hl std">= ymax,</span> <span class="hl kwc">ymin</span> <span class="hl std">= ymin,</span> <span class="hl kwc">fill</span> <span class="hl std">= Phylum),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl num">NA</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">xlim</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">4</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_polar</span><span class="hl std">(</span><span class="hl kwc">theta</span> <span class="hl std">=</span> <span class="hl str">&quot;y&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_manual</span><span class="hl std">(</span><span class="hl kwc">values</span> <span class="hl std">= phyla_colors)</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_text</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">=</span> <span class="hl kwd">subset</span><span class="hl std">(enrich,</span> <span class="hl kwd">is.na</span><span class="hl std">(ymin)),</span>
              <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">label</span> <span class="hl std">= Total),</span> <span class="hl kwc">x</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">= text_size,</span>
              <span class="hl kwc">fontface</span> <span class="hl std">=</span> <span class="hl str">&quot;bold&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl std">theme_blackbox</span> <span class="hl opt">+</span>
    <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">axis.text</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
          <span class="hl kwc">axis.ticks</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">())</span>
  <span class="hl com">#p1</span>
  <span class="hl kwd">return</span><span class="hl std">(p1)</span>
<span class="hl std">}</span>

<span class="hl com">#' Take a set of enrichments or depletions and make</span>
<span class="hl com">#' The object for geom_rect</span>
<span class="hl std">calculate_enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">enrich</span><span class="hl std">,</span> <span class="hl kwc">top_phyla</span> <span class="hl std">= top_phyla,</span> <span class="hl kwc">mut_order</span><span class="hl std">){</span>
  <span class="hl com">#  mut_order &lt;- pepr_order</span>

  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">Enrichment</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span>
  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">Phylum[</span> <span class="hl opt">!</span><span class="hl std">(enrich</span><span class="hl opt">$</span><span class="hl std">Phylum</span> <span class="hl opt">%in%</span> <span class="hl std">top_phyla) ]</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;Low Abundance&quot;</span>
  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">Phylum</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(enrich</span><span class="hl opt">$</span><span class="hl std">Phylum,</span> <span class="hl kwc">levels</span> <span class="hl std">= top_phyla )</span>
  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">Genotype</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(enrich</span><span class="hl opt">$</span><span class="hl std">Genotype,</span> <span class="hl kwc">levels</span> <span class="hl std">= mut_order[</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl opt">-</span><span class="hl kwd">length</span><span class="hl std">(mut_order))])</span>
  <span class="hl std">enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">acast</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= enrich,</span> <span class="hl kwc">formula</span> <span class="hl std">= Phylum</span> <span class="hl opt">~</span> <span class="hl std">Genotype,</span> <span class="hl kwc">fun.aggregate</span> <span class="hl std">= sum,</span> <span class="hl kwc">value.var</span> <span class="hl std">=</span> <span class="hl str">&quot;Enrichment&quot;</span><span class="hl std">,</span> <span class="hl kwc">drop</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>

  <span class="hl std">enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">t</span><span class="hl std">(</span><span class="hl kwd">t</span><span class="hl std">(enrich)</span> <span class="hl opt">/</span> <span class="hl kwd">colSums</span><span class="hl std">(enrich))</span>
  <span class="hl std">enrich[</span> <span class="hl kwd">is.na</span><span class="hl std">(enrich) ]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
  <span class="hl std">enrich.ymax</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(enrich,</span><span class="hl num">2</span><span class="hl std">,cumsum)</span>
  <span class="hl std">enrich.ymin</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(enrich,</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">vec</span><span class="hl std">)</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl kwd">cumsum</span><span class="hl std">(vec)[</span><span class="hl opt">-</span><span class="hl kwd">length</span><span class="hl std">(vec)]))</span>
  <span class="hl kwd">row.names</span><span class="hl std">(enrich.ymin)</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">row.names</span><span class="hl std">(enrich)</span>

  <span class="hl std">enrich.ymin</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">melt</span><span class="hl std">(enrich.ymin,</span><span class="hl kwc">varnames</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Phylum&quot;</span><span class="hl std">,</span><span class="hl str">&quot;Genotype&quot;</span><span class="hl std">),</span><span class="hl kwc">value.name</span> <span class="hl std">=</span> <span class="hl str">&quot;ymin&quot;</span><span class="hl std">)</span>
  <span class="hl std">enrich.ymax</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">melt</span><span class="hl std">(enrich.ymax,</span><span class="hl kwc">varnames</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Phylum&quot;</span><span class="hl std">,</span><span class="hl str">&quot;Genotype&quot;</span><span class="hl std">),</span><span class="hl kwc">value.name</span> <span class="hl std">=</span> <span class="hl str">&quot;ymax&quot;</span><span class="hl std">)</span>
  <span class="hl std">enrich</span> <span class="hl kwb">&lt;-</span> <span class="hl std">enrich.ymin</span>
  <span class="hl std">enrich</span><span class="hl opt">$</span><span class="hl std">ymax</span> <span class="hl kwb">&lt;-</span> <span class="hl std">enrich.ymax</span><span class="hl opt">$</span><span class="hl std">ymax</span>

  <span class="hl kwd">return</span><span class="hl std">(enrich)</span>
<span class="hl std">}</span>

<span class="hl com">#' Test similarity of enrichments and depletions</span>
<span class="hl com">#' </span>
<span class="hl com">#' @param dat output data from plot_fracgen_heatmap</span>
<span class="hl com">#' @param wt reference genotype</span>
<span class="hl com">#' @param dist.method distance method from dist function</span>
<span class="hl com">#' @param nperm Number of permutations</span>
<span class="hl std">monte_carlo_test</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">dat</span><span class="hl std">,</span> <span class="hl kwc">wt</span> <span class="hl std">=</span> <span class="hl str">&quot;Col-0&quot;</span><span class="hl std">,</span><span class="hl kwc">dist.method</span> <span class="hl std">=</span> <span class="hl str">&quot;manhattan&quot;</span><span class="hl std">,</span>
                             <span class="hl kwc">nperm</span> <span class="hl std">=</span> <span class="hl num">1000</span><span class="hl std">){</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Enrichment</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">Enrichment))</span>
  <span class="hl std">dat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">subset</span><span class="hl std">(dat, Genotype</span> <span class="hl opt">!=</span> <span class="hl std">wt)</span>
  <span class="hl std">dat</span><span class="hl opt">$</span><span class="hl std">Genotype</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">droplevels</span><span class="hl std">(dat</span><span class="hl opt">$</span><span class="hl std">Genotype)</span>
  <span class="hl std">mat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">acast</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= dat,</span> <span class="hl kwc">formula</span> <span class="hl std">= OTU</span> <span class="hl opt">~</span> <span class="hl std">Genotype,</span>
               <span class="hl kwc">value.var</span> <span class="hl std">=</span> <span class="hl str">&quot;Enrichment&quot;</span><span class="hl std">)</span>

  <span class="hl std">all</span> <span class="hl kwb">&lt;-</span> <span class="hl std">mat</span>
  <span class="hl com">#all &lt;- all[ , -which(colnames(all) == wt) ]</span>

  <span class="hl std">all.d</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">dist</span><span class="hl std">(</span><span class="hl kwd">t</span><span class="hl std">(all),</span><span class="hl kwc">method</span><span class="hl std">=dist.method)</span>
  <span class="hl std">all.d</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.matrix</span><span class="hl std">(all.d)</span>
  <span class="hl std">D.reps</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">array</span><span class="hl std">(</span><span class="hl kwc">dim</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(all.d),</span><span class="hl kwd">nrow</span><span class="hl std">(all.d),nperm),</span>
                  <span class="hl kwc">dimnames</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwd">colnames</span><span class="hl std">(all),</span>
                                  <span class="hl kwd">colnames</span><span class="hl std">(all),</span>
                                  <span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">nperm))</span>
  <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">nperm){</span>
    <span class="hl com">#i &lt;- 1</span>
    <span class="hl std">all.rep</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(all,</span><span class="hl num">2</span><span class="hl std">,sample)</span>
    <span class="hl std">all.rep.d</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">dist</span><span class="hl std">(</span><span class="hl kwd">t</span><span class="hl std">(all.rep),</span><span class="hl kwc">method</span><span class="hl std">=dist.method)</span>
    <span class="hl std">all.rep.d</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.matrix</span><span class="hl std">(all.rep.d)</span>
    <span class="hl std">D.reps[,,i]</span> <span class="hl kwb">&lt;-</span> <span class="hl std">all.d</span> <span class="hl opt">&lt;</span> <span class="hl std">all.rep.d</span>
  <span class="hl std">}</span>
  <span class="hl std">pval</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.matrix</span><span class="hl std">(</span><span class="hl kwd">as.dist</span><span class="hl std">(</span><span class="hl num">1</span> <span class="hl opt">-</span> <span class="hl kwd">apply</span><span class="hl std">(D.reps,</span><span class="hl kwc">MARGIN</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">),sum)</span> <span class="hl opt">/</span> <span class="hl std">nperm))</span>

<span class="hl std">}</span>

<span class="hl com">##################</span>

<span class="hl com"># Create Dataset object from AMOR data</span>
<span class="hl kwd">data</span><span class="hl std">(Rhizo)</span>
<span class="hl kwd">data</span><span class="hl std">(Rhizo.map)</span>
<span class="hl kwd">data</span><span class="hl std">(Rhizo.tax)</span>

<span class="hl com"># IMPORTANT!!! We need to change the name of some variables to make them consistent with the</span>
<span class="hl com"># functions in his Dataset. These functions were designed to work with a specific dataset, and</span>
<span class="hl com"># therefore make strong assumptions about the metadata present.</span>
<span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">Fraction</span> <span class="hl kwb">&lt;-</span> <span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">fraction</span>
<span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">Depth</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">colSums</span><span class="hl std">(Rhizo)</span>
<span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">Experiment</span> <span class="hl kwb">&lt;-</span> <span class="hl str">'A'</span>
<span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">Genotype</span> <span class="hl kwb">&lt;-</span> <span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">accession</span>
<span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">fraction</span> <span class="hl kwb">&lt;-</span> <span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">accession</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">NULL</span>
<span class="hl std">Rhizo.map</span><span class="hl opt">$</span><span class="hl std">Fracgen</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">interaction</span><span class="hl std">(Rhizo.map</span><span class="hl opt">$</span><span class="hl std">Genotype,</span>
                                 <span class="hl kwd">factor</span><span class="hl std">(Rhizo.map</span><span class="hl opt">$</span><span class="hl std">Fraction,</span> <span class="hl kwc">levels</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">'E'</span><span class="hl std">,</span><span class="hl str">'R'</span><span class="hl std">,</span><span class="hl str">'Soil'</span><span class="hl std">)),</span>
                                 <span class="hl kwc">drop</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">Dat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">create_dataset</span><span class="hl std">(</span><span class="hl kwc">Tab</span> <span class="hl std">= Rhizo,</span> <span class="hl kwc">Map</span> <span class="hl std">= Rhizo.map,</span> <span class="hl kwc">Tax</span> <span class="hl std">= Rhizo.tax)</span>
<span class="hl kwd">rm</span><span class="hl std">(Rhizo, Rhizo.map, Rhizo.tax)</span>
<span class="hl std">Dat</span>
</pre></div>
<div class="output"><pre class="knitr r">## A Dataset object:
##   There are 129 taxa in 69 samples
##   There are 7 metadata variables
## 
##   Samples: D1,D2,D3,D10,D57...
##   Taxa: OTU_14834,OTU_18567,OTU_14402,OTU_14822,OTU_16757...
##   Variables: soil,plate,Fraction,Depth,Experiment...
## 
##   The most abundant taxon is (are): OTU_14834
##   The highet abundance is: 1046
## 
##   The most prevalent taxon is (are): OTU_15154
##   The highet prevalence is: 67
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># This is not an appropriate model, and it will throw a bunch of errors, but it serves as</span>
<span class="hl com"># demonstration</span>
<span class="hl std">m1</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">matrix_glm</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= Dat,</span><span class="hl kwc">formula</span> <span class="hl std">=</span> <span class="hl opt">~</span> <span class="hl std">soil</span> <span class="hl opt">+</span> <span class="hl std">Fraction</span> <span class="hl opt">+</span> <span class="hl std">Genotype</span> <span class="hl opt">+</span> <span class="hl std">Fracgen</span> <span class="hl opt">+</span> <span class="hl std">plate)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm stopped at boundary value
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm stopped at boundary value
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence

## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm did not converge
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: algorithm stopped at boundary value
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted rates numerically 0 occurred
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: step size truncated due to divergence
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">Full</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">summary</span><span class="hl std">(m1)</span><span class="hl opt">$</span><span class="hl std">coefficients</span>
<span class="hl std">Full</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">droplevels</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(Full,</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(p.value)))</span>
<span class="hl std">Full</span><span class="hl opt">$</span><span class="hl std">q.value</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">p.adjust</span><span class="hl std">(Full</span><span class="hl opt">$</span><span class="hl std">p.value,</span> <span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">'fdr'</span><span class="hl std">)</span>
<span class="hl kwd">head</span><span class="hl std">(Full)</span>
</pre></div>
<div class="output"><pre class="knitr r">##       Taxon    Variable    Estimate    StdErr     z.value     p.value    q.value
## 1 OTU_14834 (Intercept) -1.12406548 0.4599587 -2.44383981 0.014531877 0.10555249
## 2 OTU_18567 (Intercept)  0.37986606 1.1046470  0.34388005 0.730936499 1.00000000
## 3 OTU_14402 (Intercept) -1.91472265 0.9135212 -2.09598057 0.036083915 0.20743427
## 4 OTU_14822 (Intercept)  0.06136843 1.5933048  0.03851644 0.969275926 1.00000000
## 6 OTU_15154 (Intercept)  1.71577880 0.6426854  2.66970234 0.007591852 0.06635155
## 7  OTU_7054 (Intercept)  0.93869621 0.4527538  2.07330375 0.038144020 0.21468493
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># This function, though it generates a plot, can also be used to reformat data</span>
<span class="hl com"># NOTE WE ARE USING AN ABSURD Q-VALUE THRESHOLD (0.5) FOR DEMONSTRATION PURPOSES ONLY</span>
<span class="hl std">p1</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plot_fragen_heatmap</span><span class="hl std">(</span><span class="hl kwc">Full</span> <span class="hl std">= Full,</span> <span class="hl kwc">Dat</span> <span class="hl std">= Dat,</span> <span class="hl kwc">group</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;A&quot;</span><span class="hl std">),</span>
                          <span class="hl kwc">variable</span> <span class="hl std">=</span> <span class="hl str">&quot;Genotype&quot;</span><span class="hl std">,</span> <span class="hl kwc">sig_thres</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">,</span>
                          <span class="hl kwc">pool.FUN</span> <span class="hl std">= mean,</span> <span class="hl kwc">phyl.level</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">,</span>
                          <span class="hl kwc">mut_order</span> <span class="hl std">=</span> <span class="hl kwd">levels</span><span class="hl std">(Dat</span><span class="hl opt">$</span><span class="hl std">Map</span><span class="hl opt">$</span><span class="hl std">Genotype))</span>
<span class="hl std">dat</span> <span class="hl kwb">&lt;-</span> <span class="hl std">p1</span><span class="hl opt">$</span><span class="hl std">data</span>
<span class="hl kwd">head</span><span class="hl std">(dat)</span>
</pre></div>
<div class="output"><pre class="knitr r">##          OTU Genotype Abundance Enrichment                                  Phylum   Type
## 33 OTU_11102      Ler 0.0000000         -1  Root;Root;k__Bacteria;p__Acidobacteria Mutant
## 23 OTU_19108      Ler 0.3155737         -1 Root;Root;k__Bacteria;p__Actinobacteria Mutant
## 36  OTU_2279      Ler 0.6709257         -1  Root;Root;k__Bacteria;p__Cyanobacteria Mutant
## 25 OTU_15877      Ler 0.3061643         -1     Root;Root;k__Bacteria;p__Firmicutes Mutant
## 27 OTU_19245      Ler 0.5260866         -1 Root;Root;k__Bacteria;p__Proteobacteria Mutant
## 28 OTU_13953      Ler 0.6296023         -1 Root;Root;k__Bacteria;p__Proteobacteria Mutant
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># The way the model was specified, there is only one genotype to compare (Ler).</span>
<span class="hl com"># I'm going create a fake genotype and assign some enrichments and depletions</span>
<span class="hl com"># because we need at least two groups for comparisons</span>
<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">193</span><span class="hl std">)</span>
<span class="hl std">t</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">subset</span><span class="hl std">(dat, Genotype</span> <span class="hl opt">==</span> <span class="hl str">'Col'</span><span class="hl std">)</span>
<span class="hl std">t</span><span class="hl opt">$</span><span class="hl std">Enrichment[</span> <span class="hl kwd">sample</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(t),</span><span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">5</span><span class="hl std">) ]</span> <span class="hl kwb">&lt;-</span> <span class="hl str">'-1'</span>
<span class="hl std">t</span><span class="hl opt">$</span><span class="hl std">Enrichment[</span> <span class="hl kwd">sample</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(t),</span><span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">5</span><span class="hl std">) ]</span> <span class="hl kwb">&lt;-</span> <span class="hl str">'1'</span>
<span class="hl std">t</span><span class="hl opt">$</span><span class="hl std">Genotype</span> <span class="hl kwb">&lt;-</span> <span class="hl str">'mygen'</span>
<span class="hl std">t</span>
</pre></div>
<div class="output"><pre class="knitr r">##          OTU Genotype  Abundance Enrichment                                  Phylum
## 10  OTU_3149    mygen 0.00000000          0  Root;Root;k__Bacteria;p__Acidobacteria
## 14 OTU_11102    mygen 0.00000000          0  Root;Root;k__Bacteria;p__Acidobacteria
## 4  OTU_19108    mygen 0.41659448          1 Root;Root;k__Bacteria;p__Actinobacteria
## 7  OTU_18407    mygen 0.72123734          0 Root;Root;k__Bacteria;p__Actinobacteria
## 1  OTU_18954    mygen 0.03980101          0  Root;Root;k__Bacteria;p__Bacteroidetes
## 12 OTU_14836    mygen 0.00000000         -1  Root;Root;k__Bacteria;p__Bacteroidetes
## 13   OTU_773    mygen 0.05765907          0  Root;Root;k__Bacteria;p__Bacteroidetes
## 15   OTU_636    mygen 1.35308824          0  Root;Root;k__Bacteria;p__Bacteroidetes
## 16 OTU_18539    mygen 0.03815867          1  Root;Root;k__Bacteria;p__Bacteroidetes
## 17  OTU_2279    mygen 1.34084275          0  Root;Root;k__Bacteria;p__Cyanobacteria
## 6  OTU_15877    mygen 1.11869993          1     Root;Root;k__Bacteria;p__Firmicutes
## 2  OTU_19706    mygen 0.29319613          0 Root;Root;k__Bacteria;p__Proteobacteria
## 3  OTU_19511    mygen 1.13908493          1 Root;Root;k__Bacteria;p__Proteobacteria
## 5  OTU_18240    mygen 0.06891086         -1 Root;Root;k__Bacteria;p__Proteobacteria
## 8  OTU_19245    mygen 0.21431633          0 Root;Root;k__Bacteria;p__Proteobacteria
## 9  OTU_13953    mygen 0.46893938          0 Root;Root;k__Bacteria;p__Proteobacteria
## 11 OTU_13635    mygen 0.17159607          0 Root;Root;k__Bacteria;p__Proteobacteria
## 18 OTU_12223    mygen 1.58462397         -1 Root;Root;k__Bacteria;p__Proteobacteria
## 19  OTU_7118    mygen 0.82392633          1 Root;Root;k__Bacteria;p__Proteobacteria
##      Type
## 10 Mutant
## 14 Mutant
## 4  Mutant
## 7  Mutant
## 1  Mutant
## 12 Mutant
## 13 Mutant
## 15 Mutant
## 16 Mutant
## 17 Mutant
## 6  Mutant
## 2  Mutant
## 3  Mutant
## 5  Mutant
## 8  Mutant
## 9  Mutant
## 11 Mutant
## 18 Mutant
## 19 Mutant
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">dat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">rbind</span><span class="hl std">(dat,t)</span>

<span class="hl com"># Plot doughnut</span>
<span class="hl std">p1</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">doughnut_plot</span><span class="hl std">(</span><span class="hl kwc">dat</span> <span class="hl std">= dat,</span>
                    <span class="hl kwc">top_phyla</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Root;Root;k__Bacteria;p__Actinobacteria&quot;</span><span class="hl std">,</span>
                                  <span class="hl str">&quot;Root;Root;k__Bacteria;p__Bacteroidetes&quot;</span><span class="hl std">,</span>
                                  <span class="hl str">&quot;Root;Root;k__Bacteria;p__Proteobacteria&quot;</span><span class="hl std">,</span>
                                  <span class="hl str">&quot;Low Abundance&quot;</span><span class="hl std">),</span>
                    <span class="hl kwc">mut_order</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">'Col'</span><span class="hl std">,</span><span class="hl str">'Ler'</span><span class="hl std">,</span><span class="hl str">'mygen'</span><span class="hl std">,</span><span class="hl str">'Soil'</span><span class="hl std">),</span> <span class="hl kwc">phyla_colors</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">'red'</span><span class="hl std">,</span> <span class="hl str">'blue'</span><span class="hl std">,</span> <span class="hl str">'orange'</span><span class="hl std">,</span><span class="hl str">'black'</span><span class="hl std">))</span>
<span class="hl std">p1</span>
</pre></div>
</div><div class="rimage center"><img src="figure/1-Dataset-2-montecarlo-Rhtmlauto-report-1.png" title="plot of chunk auto-report" alt="plot of chunk auto-report" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">7151</span><span class="hl std">)</span>
<span class="hl std">pval</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">monte_carlo_test</span><span class="hl std">(</span><span class="hl kwc">dat</span> <span class="hl std">= dat,</span><span class="hl kwc">wt</span> <span class="hl std">=</span> <span class="hl str">'Col'</span><span class="hl std">,</span> <span class="hl kwc">nperm</span> <span class="hl std">=</span> <span class="hl num">5000</span><span class="hl std">)</span>
<span class="hl std">pval</span>
</pre></div>
<div class="output"><pre class="knitr r">##          Ler  mygen
## Ler   0.0000 0.9486
## mygen 0.9486 0.0000
</pre></div>
</div></div>

  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r">    <span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.4.2 (2017-09-28)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 16.04.3 LTS
## 
## Matrix products: default
## BLAS: /usr/lib/libblas/libblas.so.3.6.0
## LAPACK: /usr/lib/lapack/liblapack.so.3.6.0
## 
## locale:
##  [1] LC_CTYPE=es_US.UTF-8       LC_NUMERIC=C               LC_TIME=es_US.UTF-8       
##  [4] LC_COLLATE=es_US.UTF-8     LC_MONETARY=es_US.UTF-8    LC_MESSAGES=es_US.UTF-8   
##  [7] LC_PAPER=es_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
## [10] LC_TELEPHONE=C             LC_MEASUREMENT=es_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  base     
## 
## other attached packages:
## [1] AMOR_0.0-15     MASS_7.3-47     reshape2_1.4.2  ggdendro_0.1-20 ggplot2_2.2.1  
## [6] knitr_1.16     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.12     digest_0.6.12    plyr_1.8.4       gtable_0.2.0     magrittr_1.5    
##  [6] evaluate_0.10.1  scales_0.4.1     highr_0.6        rlang_0.1.1      stringi_1.1.5   
## [11] lazyeval_0.2.0   labeling_0.3     tools_3.4.2      stringr_1.2.0    munsell_0.4.3   
## [16] compiler_3.4.2   colorspace_1.3-2 methods_3.4.2    tibble_1.3.3
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;2017-11-21 12:35:07 PST&quot;
</pre></div>
</div></div>


</body>
</html>
